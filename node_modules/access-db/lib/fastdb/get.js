"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const pathTo_1 = require("../utils/pathTo");
const error_1 = require("../constants/error");
const utils_1 = require("../utils/utils");
const fs = require('fs');
function fetchGet(table, id) {
    const filePath = pathTo_1.pathTo(table);
    let oldBuf, result;
    if (!fs.existsSync(filePath)) {
        throw new Error(error_1.FASTDB_FILE_ERROR);
    }
    if (!id) {
        throw new Error(error_1.FASTDB_GET_ID_ERROR);
    }
    oldBuf = fs.readFileSync(filePath);
    let start = utils_1.isNumber(id) ? oldBuf.indexOf(`{"_fid":${id}`) : oldBuf.indexOf(`{"_fid":"${id}"`);
    if (start === -1) {
        // 没有
        result = {};
    }
    else {
        let end = oldBuf.indexOf(`,{"_fid"`, start + 8);
        if (end === -1) {
            end = oldBuf.length - 1;
        }
        result = JSON.parse(oldBuf.slice(start, end).toString());
    }
    return { data: result };
}
exports.default = fetchGet;
