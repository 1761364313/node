"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const pathTo_1 = require("../utils/pathTo");
const error_1 = require("../constants/error");
const utils_1 = require("../utils/utils");
const fs = require('fs');
function fetchDel(table, id) {
    const filePath = pathTo_1.pathTo(table);
    let oldBuf, result, start = -1, end = -1;
    if (!fs.existsSync(filePath)) {
        throw new Error(error_1.FASTDB_FILE_ERROR);
    }
    if (!id) {
        throw new Error(error_1.FASTDB_GET_ID_ERROR);
    }
    oldBuf = fs.readFileSync(filePath);
    start = utils_1.isNumber(id) ? oldBuf.indexOf(`{"_fid":${id}`) : oldBuf.indexOf(`{"_fid":"${id}"`);
    if (start === -1) {
        // 没有
        result = 0;
    }
    else {
        end = oldBuf.indexOf(`,{"_fid"`, start + 8);
        if (end === -1) {
            // 没有
            end = oldBuf.length - 1;
        }
        else {
            end = start === 1 ? end + 1 : end;
        }
        let leftBuf = oldBuf.slice(0, start === 1 ? start : start - 1);
        let rightBuf = oldBuf.slice(end);
        let resBuf = Buffer.concat([leftBuf, rightBuf]);
        fs.writeFileSync(filePath, resBuf);
        result = 1;
    }
    return { data: result };
}
exports.default = fetchDel;
